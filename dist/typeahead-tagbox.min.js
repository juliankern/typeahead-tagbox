"use strict";function typeaheadTagbox(e){function t(t){var n=i("."+e.dropdownItemClass+":nth-child("+t+")");i("."+e.dropdownItemClass+"."+e.dropdownSelectedClass)&&i("."+e.dropdownItemClass+"."+e.dropdownSelectedClass).classList.remove(e.dropdownSelectedClass),y=e.data.find(function(e){return e.id===+n.dataset.id}),n.classList.add(e.dropdownSelectedClass)}function n(t){u.value="",o(t),s(),u.focus(),e.onClickDropdownOption&&"function"==typeof e.onClickDropdownOption&&e.onClickDropdownOption(t)}function a(t){g.splice(g.findIndex(function(n){return n[e.idKey]===t[e.idKey]}),1),r.value=JSON.stringify(g),e.onRemoveTag&&"function"==typeof e.onRemoveTag&&e.onRemoveTag(t,g),i("."+e.tagClass+'[data-id="'+t[e.idKey]+'"]').remove()}function o(t){var n=document.createElement("span"),o=document.createElement("button"),d=l("."+e.tagClass);n.innerHTML=t[e.textKey],o.dataset.id=t.id,o.innerHTML=e.tagDeleteButtonContent,n.dataset.id=t[e.idKey],n.setAttribute("class",e.tagClass),o.addEventListener("click",function(){a(t)}),g.push(t),e.onAddTag&&"function"==typeof e.onAddTag&&e.onAddTag(t,g),r.value=JSON.stringify(g),d.length>0?d[l("."+e.tagClass).length-1].after(n):p.prepend(n),n.append(o)}function d(t,a){var o=void 0;c.innerHTML="",t.forEach(function(t){(o=document.createElement("li")).classList.add(e.dropdownItemClass),o.dataset.id=t.id,o.innerHTML=e.dropdownItemTemplate.replace(/{{text}}/g,t[e.textKey].replace(new RegExp(a,e.caseSensitive?"g":"gi"),'<span class="'+e.highlightClass+'">$&</span>')).replace(/{{id}}/g,t[e.idKey]).replace(/{{(\w+)}}/g,function(e,n){return t[n]||""}),o.addEventListener("click",function(){n(t)}),m++,c.append(o)}),v=!0,f=0,c.style.display="block",e.onOpenDropdown&&"function"==typeof e.onOpenDropdown&&e.onOpenDropdown(a,t)}function s(){c.innerHTML="",v=!1,m=0,y=void 0,c.style.display="none"}function i(e){return document.querySelector(e)}function l(e){return document.querySelectorAll(e)}var r=i((e=Object.assign({caseSensitive:!1,data:[],dropdownClass:"typeahead-dropdown",dropdownItemClass:"typeahead-dropdown-item",dropdownItemTemplate:"{{text}}",dropdownSelectedClass:"selected",highlightClass:"typeahead-highlight",idKey:"id",inputClass:"typeahead-input",inputPlaceholder:"add...",minLength:2,onAddTag:void 0,onClickDropdownOption:void 0,onOpenDropdown:void 0,onRemoveTag:void 0,selector:".typeahead-tagbox",tagClass:"typeahead-tag",tagDeleteButtonContent:"x",tagRemovingClass:"removing",textKey:"text",typeaheadClass:"typeahead"},e)).selector),p=document.createElement("div"),c=document.createElement("ul"),u=document.createElement("input"),g=[],v=!1,f=0,y=void 0,m=0,h=void 0;if(!r)throw"Tagbox element not found";p.classList.add(e.typeaheadClass),c.classList.add(e.dropdownClass),u.classList.add(e.inputClass),u.type="text",u.placeholder=e.inputPlaceholder,r.after(p),r.type="hidden",r.remove(),p.append(r),p.append(u),p.append(c),p.addEventListener("click",function(){u.focus()}),p.addEventListener("keydown",function(o){var d=o.target.value;if(v&&("ArrowDown"===o.key&&f<m&&(o.preventDefault(),t(++f)),"ArrowUp"===o.key&&f>0&&(o.preventDefault(),t(--f)),"Enter"===o.key&&y&&(o.preventDefault(),n(y))),d.length||"Backspace"!==o.key)i("."+e.tagClass+"."+e.tagRemovingClass)&&(h=void 0,i("."+e.tagClass+"."+e.tagRemovingClass).classList.remove(e.tagRemovingClass));else{var s=l("."+e.tagClass);o.preventDefault(),h?(a(h),h=void 0):(h=g[g.length-1],s[s.length-1].classList.add(e.tagRemovingClass))}}),p.addEventListener("input",function(t){var n=t.target.value;if(n.length>=e.minLength){var a=e.data.filter(function(t){var a=t[e.textKey];return e.caseSensitive||(a=a.toLowerCase(),n=n.toLowerCase()),a.includes(n)&&!g.find(function(n){return n[e.idKey]===t[e.idKey]})});a.length>0&&d(a,n)}else 0===n.length&&s()})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=typeaheadTagbox;